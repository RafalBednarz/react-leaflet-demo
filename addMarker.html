<html>
<head>
    <title>Adding or moving markers on a Leaflet map</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
    <style type="text/css">
        html, body, #map{
            height: 90%;
            padding: 0;
            margin: 0;
        }
    </style>

</head>
<body>

<div id="map"></div>
<div><button id="addLocation">Add Location</button></div>
<p id="demo"></p>

<script type="text/javascript">

    var options = {
        center: [52.10418, 18.62987],
        zoom: 10
    }

    var map = L.map('map', options);

    const token = 'pk.eyJ1IjoicmJlZG5hcnoiLCJhIjoiY2psdmpmY3dmMHFreTNxcXZwbWQ0b2d5ZyJ9.TnVzeqFz-gaTNhfD6nFulQ';

   L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v10/tiles/{z}/{x}/{y}@2x?access_token=' + token, {attribution: 'OSM'})
        .addTo(map);

    var myMarker = L.marker([52.10418, 18.62987], {title: "MyPoint", alt: "The Big I", draggable: true})
        .addTo(map)
        .on('dragend', function() {
            var coord = String(myMarker.getLatLng()).split(',');
            console.log(coord);
            var lat = coord[0].split('(');
            console.log(lat);
            var lng = coord[1].split(')');
            console.log(lng);
            myMarker.bindPopup("Moved to: " + lat[1] + ", " + lng[0] + ".");
        });
    document.getElementById("addLocation").addEventListener("click", function(){
        console.log("latitude " + String(myMarker.getLatLng()).split(',')[0].split('(')[1]);
        console.log("longitude " + String(myMarker.getLatLng()).split(',')[1].split(')')[0]);

        fetch('http://localhost:8080/locations', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                "title": "nowy apartament",
                "city": "KRAKOW",
                "price": 1000,
                "latitudex": String(myMarker.getLatLng()).split(',')[0].split('(')[1],
                "longitudey": String(myMarker.getLatLng()).split(',')[1].split(')')[0]
            })
        })
        document.getElementById("demo").innerHTML = "Location has been added";
    });
</script>

</body>
</html>
